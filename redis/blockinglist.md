# 阻塞操作

Redis中有三个阻塞命令blpop、brpop和brpoplpush，这些命令可能会造成客户端被阻塞。接下来我们以blpop命令为例子讲解一下阻塞版的lpop命令是如何运行的。

* 如果用户执行BLPOP命令，且指定List不为空，那么程序就直接调用非阻塞的LPOP命令（所以blpop、brpop和brpoplpush只是有可能造成客户端阻塞）。 
* 如果用户执行BLPOP命令，且指定List为空，这时需要阻塞操作。**Redis将相应客户端的状态设置为“阻塞”状态，同时将该客户端添加到db->blocking_keys中。db->blocking_keys是一个字典结构，它的key为被阻塞的键，它的value是一个保存被阻塞客户端的列表。我们暂且把该过程称之为“阻塞过程”**。 

* 随后如果有PUSH命令往被阻塞的键中添加元素时，**Redis将这个键标识为ready状态。当这个命令执行完毕后，Redis会按照先阻塞先服务的顺序将列表的元素返回给被阻塞的客户端，并且解除阻塞状态的客户端数量取决于PUSH命令添加的元素个数。我们暂且把该过程称作为“解除阻塞过程”**。

